<?xml version="1.0" encoding="UTF-8"?>
<!--
  Created by IntelliJ IDEA.
  User: vadim
  Date: 09.10.2023
  Time: 15:43
-->
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:a="http://xmlns.jcp.org/jsf/passthrough"
>
<h:body>
    <div class="black-box centered" id="shooting-gallery">
        <h1>Тир</h1>
        <div id="aim">
            <h:graphicImage library="img" name="aim-bottom.svg" id="aim-bottom"/>
            <canvas id="aim-top" width="400" height="400"/>
        </div>
        <f:event type="preRenderView" listener="#{shotListBean.loadShots()}"/>
        <h:form id="graph-shooting-gallery" prependId="false">
            <h:inputHidden id="graph-x" value="#{graphBean.x}"/>
            <h:inputHidden id="graph-y" value="#{graphBean.y}"/>
            <h:commandButton id="graph-submit" style="display: none;"
                             action="#{shotListBean.addShot(graphBean.x, graphBean.y, rBean.r)}">
                <f:ajax execute="@all" render="previous-shots-table"/>
            </h:commandButton>
        </h:form>
        <h:form id="element-shooting-gallery" prependId="false" styleClass="centered">
            <h:inputHidden value="#{zoneBean.offsetSeconds}" id="zone"/>
            <table>
                <tr>
                    <td>X:</td>
                    <td>
                        <table>
                            <tr>
                                <td>
                                    <h:inputHidden id="x-validate" value="#{xBean.allSelectedValues}"
                                                   validator="#{xBean.validateX}" converter="bigDecimalListConverter"/>
                                    <h:selectBooleanCheckbox styleClass="x" value="#{xBean.xs[bdUtilBean.valueOf(-3)]}"
                                                             id="x-3">
                                        <f:ajax listener="#{xBean.update()}"/>
                                        <f:validateRequired/>
                                    </h:selectBooleanCheckbox>
                                    <h:outputLabel for="x-3" value="-3"/>
                                </td>
                                <td>
                                    <h:selectBooleanCheckbox styleClass="x" value="#{xBean.xs[bdUtilBean.valueOf(-2)]}"
                                                             id="x-2">
                                        <f:ajax listener="#{xBean.update()}"/>
                                    </h:selectBooleanCheckbox>
                                    <h:outputLabel for="x-2" value="-2"/>
                                </td>
                                <td>
                                    <h:selectBooleanCheckbox styleClass="x" value="#{xBean.xs[bdUtilBean.valueOf(-1)]}"
                                                             id="x-1">
                                        <f:ajax listener="#{xBean.update()}"/>
                                    </h:selectBooleanCheckbox>
                                    <h:outputLabel for="x-1" value="-1"/>
                                </td>
                                <td>
                                    <h:selectBooleanCheckbox styleClass="x" value="#{xBean.xs[bdUtilBean.valueOf(0)]}"
                                                             id="x0">
                                        <f:ajax listener="#{xBean.update()}"/>
                                    </h:selectBooleanCheckbox>
                                    <h:outputLabel for="x0" value="0"/>
                                </td>
                                <td>
                                    <h:selectBooleanCheckbox styleClass="x" value="#{xBean.xs[bdUtilBean.valueOf(1)]}"
                                                             id="x1">
                                        <f:ajax listener="#{xBean.update()}"/>
                                    </h:selectBooleanCheckbox>
                                    <h:outputLabel for="x1" value="1"/>
                                </td>
                                <td>
                                    <h:selectBooleanCheckbox styleClass="x" value="#{xBean.xs[bdUtilBean.valueOf(2)]}"
                                                             id="x2">
                                        <f:ajax listener="#{xBean.update()}"/>
                                    </h:selectBooleanCheckbox>
                                    <h:outputLabel for="x2" value="2"/>
                                </td>
                                <td>
                                    <h:selectBooleanCheckbox styleClass="x" value="#{xBean.xs[bdUtilBean.valueOf(3)]}"
                                                             id="x3">
                                        <f:ajax listener="#{xBean.update()}"/>
                                    </h:selectBooleanCheckbox>
                                    <h:outputLabel for="x3" value="3"/>
                                </td>
                                <td>
                                    <h:selectBooleanCheckbox styleClass="x" value="#{xBean.xs[bdUtilBean.valueOf(4)]}"
                                                             id="x4">
                                        <f:ajax listener="#{xBean.update()}"/>
                                    </h:selectBooleanCheckbox>
                                    <h:outputLabel for="x4" value="4"/>
                                </td>
                                <td>
                                    <h:selectBooleanCheckbox styleClass="x" value="#{xBean.xs[bdUtilBean.valueOf(5)]}"
                                                             id="x5">
                                        <f:ajax listener="#{xBean.update()}"/>
                                    </h:selectBooleanCheckbox>
                                    <h:outputLabel for="x5" value="5"/>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td>Y:</td>
                    <td>
                        <table>
                            <tr>
                                <td>
                                    <h:inputText id="y" a:placeholder="(-4..4)"
                                                 a:length=""
                                                 value="#{yBean.y}"
                                                 validator="#{yBean.validateY}" converter="javax.faces.BigDecimal">
                                        <f:validateRequired/>
                                    </h:inputText>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td>R:</td>
                    <td>
                        <h:selectOneRadio value="#{rBean.r}" validator="#{rBean.validateR}" id="r">
                            <f:selectItems
                                    value="#{rBean.rValues}"
                                    var="choice"
                                    itemValue="#{choice}"
                                    itemLabel="#{choice}"
                            />
                            <f:validateRequired/>
                            <f:converter converterId="javax.faces.BigDecimal"/>
                            <f:ajax execute="@this" render="@this"/>
                        </h:selectOneRadio>
                    </td>
                </tr>
            </table>
            <h:messages styleClass="error-message"/>
            <table>
                <tr style="text-align: center;">
                    <td>
                        <h:commandButton id="submit-button" value="Выстрелить">
                            <f:ajax execute="@form" listener="#{shotListBean.addShots()}"
                                    render="@form previous-shots-table"/>
                        </h:commandButton>
                    </td>
                    <td>
                        <h:commandButton id="clear-button" value="Очистить выстрелы">
                            <f:ajax listener="#{shotListBean.clearShots()}"
                                    render="@form previous-shots-table"/>
                        </h:commandButton>
                    </td>
                </tr>
            </table>
        </h:form>
        <h:outputScript library="js" name="storage.js" target="body" defer="true"/>
        <h:outputScript library="js" name="canvas.js" target="body" defer="true"/>
        <h:outputScript library="js" name="misc.js" target="body" defer="true"/>
        <h:outputScript target="body" defer="true">
            document.addEventListener('DOMContentLoaded', () => {
                miscMain();
                storageMain();
                canvasMain();
            });

            window.addEventListener('load', () => {
                redrawCanvas(#{rBean.r});
            });
        </h:outputScript>
    </div>
</h:body>

</html>